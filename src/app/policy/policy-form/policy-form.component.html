
<form [formGroup]="policyForm" (ngSubmit)="handleSubmit()">
  <mat-stepper [linear]="isLinear" #stepper>
    <!-- Step 1: Basic Information -->
    <mat-step [stepControl]="basicInfoForm">
      <ng-template matStepLabel>Basic</ng-template>
      <form [formGroup]="basicInfoForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Vehicle Type</mat-label>
            <mat-select formControlName="vehicleType" required>
              <mat-option *ngFor="let type of vehicleTypes" [value]="type">{{ type }}</mat-option>
            </mat-select>
            <mat-error *ngIf="basicInfoForm.get('vehicleType')?.hasError('required')">
              Vehicle Type is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Make</mat-label>
            <input matInput formControlName="make" placeholder="Enter make" required maxlength="100">
            <mat-error *ngIf="basicInfoForm.get('make')?.hasError('required')">
              Make is required.
            </mat-error>
            <mat-error *ngIf="basicInfoForm.get('make')?.hasError('pattern')">
              Make must be alphanumeric.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Model</mat-label>
            <input matInput formControlName="model" placeholder="Enter model" required maxlength="100">
            <mat-error *ngIf="basicInfoForm.get('model')?.hasError('required')">
              Model is required.
            </mat-error>
            <mat-error *ngIf="basicInfoForm.get('model')?.hasError('pattern')">
              Model must be alphanumeric.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 2: Vehicle Details -->
    <mat-step [stepControl]="vehicleDetailsForm">
      <ng-template matStepLabel>Vehicle</ng-template>
      <form [formGroup]="vehicleDetailsForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Model Year</mat-label>
            <input matInput formControlName="modelYear" type="text" placeholder="Enter model year" required maxlength="4">
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('required')">
              Model Year is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('minlength')">
              Model Year must be at least 4 digits.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('modelYear')?.hasError('yearInvalid')">
              {{ vehicleDetailsForm.get('modelYear')?.errors?.['yearInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Purchase Year</mat-label>
            <input matInput formControlName="purchaseYear" type="text" placeholder="Enter purchase year" required maxlength="4">
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('required')">
              Purchase Year is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('minlength')">
              Purchase Year must be at least 4 digits.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseYear')?.hasError('yearInvalid')">
              {{ vehicleDetailsForm.get('purchaseYear')?.errors?.['yearInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Purchase Amount</mat-label>
            <input matInput formControlName="purchaseAmount" type="number" placeholder="Enter purchase amount (â‚¹)" required>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseAmount')?.hasError('required')">
              Purchase Amount is required.
            </mat-error>
            <mat-error *ngIf="vehicleDetailsForm.get('purchaseAmount')?.hasError('purchaseAmountInvalid')">
              Purchase Amount must be greater than 0.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 3: Additional Details -->
    <mat-step [stepControl]="additionalDetailsForm">
      <ng-template matStepLabel>Extras</ng-template>
      <form [formGroup]="additionalDetailsForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>VIN</mat-label>
            <input matInput formControlName="vin" placeholder="Enter VIN" required maxlength="17">
            <mat-error *ngIf="additionalDetailsForm.get('vin')?.hasError('required')">
              VIN is required.
            </mat-error>
            <mat-error *ngIf="additionalDetailsForm.get('vin')?.hasError('vinInvalid')">
              {{ additionalDetailsForm.get('vin')?.errors?.['vinInvalid'] }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Engine Number</mat-label>
            <input matInput formControlName="engineNo" placeholder="Enter engine number" required maxlength="10">
            <mat-error *ngIf="additionalDetailsForm.get('engineNo')?.hasError('required')">
              Engine Number is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Color</mat-label>
            <input matInput formControlName="color" placeholder="Enter color" required maxlength="60">
            <mat-error *ngIf="additionalDetailsForm.get('color')?.hasError('required')">
              Color is required.
            </mat-error>
            <mat-error *ngIf="additionalDetailsForm.get('color')?.hasError('pattern')">
              Color must contain only letters.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 4: Vehicle Specs -->
    <mat-step [stepControl]="vehicleSpecsForm">
      <ng-template matStepLabel>Specs</ng-template>
      <form [formGroup]="vehicleSpecsForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Fuel Type</mat-label>
            <mat-select formControlName="fuelType" required>
              <mat-option value="Petrol">Petrol</mat-option>
              <mat-option value="Diesel">Diesel</mat-option>
              <mat-option value="CNG">CNG</mat-option>
              <mat-option value="Hybrid">Hybrid</mat-option>
            </mat-select>
            <mat-error *ngIf="vehicleSpecsForm.get('fuelType')?.hasError('required')">
              Fuel Type is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Registration Number</mat-label>
            <input matInput formControlName="registrationNumber" placeholder="Enter registration number" required maxlength="40">
            <mat-error *ngIf="vehicleSpecsForm.get('registrationNumber')?.hasError('required')">
              Registration Number is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Mileage</mat-label>
            <input matInput formControlName="mileage" type="number" placeholder="Enter mileage (km/l)" required>
            <mat-error *ngIf="vehicleSpecsForm.get('mileage')?.hasError('required')">
              Mileage is required.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Step 5: Engine & Weight Details -->
    <mat-step [stepControl]="engineWeightForm">
      <ng-template matStepLabel>Engine</ng-template>
      <form [formGroup]="engineWeightForm">
        <div class="form-group">
          <mat-form-field appearance="fill">
            <mat-label>Engine CC</mat-label>
            <input matInput formControlName="engineCC" type="number" placeholder="Enter engine CC" required>
            <mat-error *ngIf="engineWeightForm.get('engineCC')?.hasError('required')">
              Engine CC is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Gross Weight</mat-label>
            <input matInput formControlName="grossWeight" type="number" placeholder="Enter gross weight (kg)" required>
            <mat-error *ngIf="engineWeightForm.get('grossWeight')?.hasError('required')">
              Gross Weight is required.
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Seat Capacity</mat-label>
            <input matInput formControlName="seatCapacity" type="number" placeholder="Enter seat capacity" required>
            <mat-error *ngIf="engineWeightForm.get('seatCapacity')?.hasError('required')">
              Seat Capacity is required.
            </mat-error>
          </mat-form-field>
        </div>

        <div class="button-group">
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button matStepperNext>Next</button>
        </div>
      </form>
    </mat-step>

    <!-- Review Step -->
    <mat-step>
      <ng-template matStepLabel>Final</ng-template>
      <div class="review-content">
        <p>Your vehicle type is: {{ policyForm.get('basicInfo.vehicleType')?.value }}</p>
        <p>Your make is: {{ basicInfoForm.value.make }}</p>
        <p>Your model is: {{ basicInfoForm.value.model }}</p>
        <p>Your model year is: {{ vehicleDetailsForm.value.modelYear }}</p>
        <p>Your purchase year is: {{ vehicleDetailsForm.value.purchaseYear }}</p>
        <p>Your purchase amount is: {{ vehicleDetailsForm.value.purchaseAmount }}</p>
        <p>Your VIN is: {{ additionalDetailsForm.value.vin }}</p>
        <p>Your engine number is: {{ additionalDetailsForm.value.engineNo }}</p>
        <p>Your color is: {{ additionalDetailsForm.value.color }}</p>
        <p>Your fuel type is: {{ vehicleSpecsForm.value.fuelType }}</p>
        <p>Your registration number is: 
          {{ vehicleSpecsForm.value.registrationNumber || autoFilledRegistrationNumber }}
        </p>        
        <p>Your mileage is: {{ vehicleSpecsForm.value.mileage }}</p>
        <p>Your engine CC is: {{ policyForm.get('engineWeight.engineCC')?.value }}</p>
        <p>Your gross weight is: {{ engineWeightForm.value.grossWeight }}</p>
        <p>Your seat capacity is: {{ policyForm.get('engineWeight.seatCapacity')?.value }}</p>
      </div>
      <div class="button-group">
        <button mat-button matStepperPrevious>Back</button>
        <button mat-button type="submit">Submit</button>
      </div>
    </mat-step>
  </mat-stepper>
</form>
